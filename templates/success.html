{% extends "base.html" %}

{% block title %}Reserva Confirmada - {{ cabin.nome }} - Attenua{% endblock %}

{% block meta %}
<meta name="description" content="Sua reserva foi confirmada com sucesso! Código: {{ code }}">
{% endblock %}

{% block body_class %}page-success{% endblock %}

{% block content %}
<!-- Success Animation -->
<div class="success-animation">
    <div class="success-icon">
        <div class="checkmark">
            <svg viewBox="0 0 52 52" class="checkmark-svg">
                <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
                <path class="checkmark-check" fill="none" d="m14.1 27.2l7.1 7.2 16.7-16.8"/>
            </svg>
        </div>
    </div>
</div>

<!-- Success Header -->
<section class="success-header">
    <h1 class="success-title">🎉 Reserva Confirmada!</h1>
    <p class="success-subtitle">
        Sua cabine foi reservada com sucesso. Confira os detalhes abaixo.
    </p>
</section>

<!-- Reservation Details -->
<section class="reservation-confirmed">
    <div class="confirmation-card">
        <div class="card-header">
            <h2>📋 Detalhes da Reserva</h2>
        </div>
        
        <div class="card-content">
            <div class="detail-grid">
                <div class="detail-item">
                    <span class="detail-icon">🏢</span>
                    <div class="detail-info">
                        <span class="detail-label">Cabine</span>
                        <span class="detail-value">{{ cabin.nome }}</span>
                    </div>
                </div>
                
                <div class="detail-item">
                    <span class="detail-icon">📅</span>
                    <div class="detail-info">
                        <span class="detail-label">Data</span>
                        <span class="detail-value" id="formattedDate">{{ date_iso }}</span>
                    </div>
                </div>
                
                <div class="detail-item">
                    <span class="detail-icon">🕐</span>
                    <div class="detail-info">
                        <span class="detail-label">Horário</span>
                        <span class="detail-value">{{ slot }}</span>
                    </div>
                </div>
                
                <div class="detail-item">
                    <span class="detail-icon">💰</span>
                    <div class="detail-info">
                        <span class="detail-label">Valor</span>
                        <span class="detail-value">R$ {{ "%.2f"|format(cabin.valor_hora) }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Access Code -->
<section class="access-code-section">
    <div class="code-card">
        <div class="code-header">
            <h2>🔑 Seu Código de Acesso</h2>
            <p>Use este código para acessar sua cabine</p>
        </div>
        
        <div class="code-display">
            <div class="code-value" id="accessCode">{{ code }}</div>
            <button class="code-copy-btn" 
                    onclick="copyCode()" 
                    aria-label="Copiar código">
                <span class="copy-icon">📋</span>
                <span class="copy-text">Copiar</span>
            </button>
        </div>
        
        <div class="code-instructions">
            <h3>📱 Como usar:</h3>
            <ol class="instructions-list">
                <li>Chegue à cabine no horário reservado</li>
                <li>Digite o código no painel de acesso</li>
                <li>A porta será desbloqueada automaticamente</li>
                <li>Entre e aproveite sua cabine!</li>
            </ol>
        </div>
    </div>
</section>

<!-- Email Confirmation -->
<section class="email-confirmation">
    <div class="email-card">
        <div class="email-icon">📧</div>
        <div class="email-content">
            <h3>Email de Confirmação</h3>
            <p>
                Enviamos todos os detalhes da sua reserva por email. 
                Verifique sua caixa de entrada e spam.
            </p>
        </div>
    </div>
</section>

<!-- Next Steps -->
<section class="next-steps">
    <div class="steps-grid">
        <div class="step-card">
            <div class="step-icon">⏰</div>
            <h3>Chegue no horário</h3>
            <p>Sua cabine estará disponível exatamente no horário reservado</p>
        </div>
        
        <div class="step-card">
            <div class="step-icon">📱</div>
            <h3>Tenha o código em mãos</h3>
            <p>Salve o código ou mantenha este email acessível</p>
        </div>
        
        <div class="step-card">
            <div class="step-icon">🆘</div>
            <h3>Precisa de ajuda?</h3>
            <p>Nossa equipe está disponível para suporte</p>
        </div>
    </div>
</section>

<!-- Actions -->
<section class="success-actions">
    <div class="actions-grid">
        <a href="{{ url_for('main.index') }}" class="btn btn-primary">
            🏠 Nova Reserva
        </a>
        
        <button onclick="window.print()" class="btn btn-secondary">
            🖨️ Imprimir Detalhes
        </button>
        
        <button onclick="shareReservation()" class="btn btn-secondary">
            📤 Compartilhar
        </button>
    </div>
</section>

<!-- Support -->
<section class="support-section">
    <div class="support-card">
        <h3>💬 Precisa de Suporte?</h3>
        <p>Nossa equipe está pronta para ajudar você</p>
        
        <div class="support-contacts">
            <a href="mailto:suporte@attenua.com" class="support-link">
                <span class="support-icon">📧</span>
                suporte@attenua.com
            </a>
            
            <a href="tel:+5511999999999" class="support-link">
                <span class="support-icon">📞</span>
                (11) 9999-9999
            </a>
            
            <a href="#" class="support-link">
                <span class="support-icon">💬</span>
                Chat Online
            </a>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
    // Formatar data para exibição
    document.addEventListener('DOMContentLoaded', function() {
        const dateElement = document.getElementById('formattedDate');
        const dateStr = '{{ date_iso }}';
        
        try {
            const date = new Date(dateStr + 'T00:00:00');
            const formatted = date.toLocaleDateString('pt-BR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            dateElement.textContent = formatted;
        } catch (e) {
            console.warn('Erro ao formatar data:', e);
        }
    });
    
    // Função para copiar código
    function copyCode() {
        const code = document.getElementById('accessCode').textContent;
        const button = document.querySelector('.code-copy-btn');
        
        navigator.clipboard.writeText(code).then(function() {
            // Feedback visual
            button.innerHTML = '<span class="copy-icon">✅</span><span class="copy-text">Copiado!</span>';
            
            setTimeout(function() {
                button.innerHTML = '<span class="copy-icon">📋</span><span class="copy-text">Copiar</span>';
            }, 2000);
        }).catch(function(err) {
            console.error('Erro ao copiar:', err);
            // Fallback para navegadores mais antigos
            const textArea = document.createElement('textarea');
            textArea.value = code;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            button.innerHTML = '<span class="copy-icon">✅</span><span class="copy-text">Copiado!</span>';
            setTimeout(function() {
                button.innerHTML = '<span class="copy-icon">📋</span><span class="copy-text">Copiar</span>';
            }, 2000);
        });
    }
    
    // Função para compartilhar reserva
    function shareReservation() {
        if (navigator.share) {
            navigator.share({
                title: 'Minha Reserva - Attenua',
                text: `Reservei a {{ cabin.nome }} para {{ date_iso }} às {{ slot }}. Código: {{ code }}`,
                url: window.location.href
            });
        } else {
            // Fallback: copiar URL
            navigator.clipboard.writeText(window.location.href);
            alert('Link copiado para a área de transferência!');
        }
    }
</script>
{% endblock %}

