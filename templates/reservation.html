{% extends "base.html" %}

{% block title %}Reservar {{ cabin.nome }} - Attenua{% endblock %}

{% block meta %}
<meta name="description" content="Finalize sua reserva da {{ cabin.nome }} no Attenua">
{% endblock %}

{% block body_class %}page-reservation{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<nav class="breadcrumb" aria-label="Navega√ß√£o estrutural">
    <ol class="breadcrumb-list">
        <li><a href="{{ url_for('main.index') }}">In√≠cio</a></li>
        <li aria-current="page">Reserva</li>
    </ol>
</nav>

<!-- Reservation Header -->
<section class="reservation-header">
    <div class="reservation-summary">
        <div class="cabin-preview">
            <img src="{{ url_for('static', filename='images/optimized/' + cabin.imagem) }}" 
                 alt="{{ cabin.nome }}"
                 class="cabin-image"
                 loading="eager">
        </div>
        
        <div class="reservation-details">
            <h1 class="cabin-title">{{ cabin.nome }}</h1>
            <p class="cabin-description">{{ cabin.descricao }}</p>
            
            <div class="reservation-info">
                <div class="info-item">
                    <span class="info-label">üìÖ Data:</span>
                    <span class="info-value" id="reservationDate">{{ reservation.date_iso }}</span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">üïê Hor√°rio:</span>
                    <span class="info-value" id="reservationTime">{{ reservation.slot }}</span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">üë• Capacidade:</span>
                    <span class="info-value">{{ cabin.capacidade }} pessoa{{ 's' if cabin.capacidade > 1 else '' }}</span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">üí∞ Valor:</span>
                    <span class="info-value price">R$ {{ "%.2f"|format(cabin.valor_hora) }}/hora</span>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Reservation Form -->
<section class="reservation-form-section">
    <div class="form-container">
        <div class="form-header">
            <h2>üìù Dados para reserva</h2>
            <p>Preencha seus dados para confirmar a reserva</p>
        </div>
        
        <form class="reservation-form" 
              action="{{ url_for('main.reserve_submit') }}" 
              method="post" 
              novalidate
              aria-label="Formul√°rio de reserva">
            
            <!-- Hidden fields -->
            <input type="hidden" name="cabin_id" value="{{ cabin.id }}">
            <input type="hidden" name="date_iso" value="{{ reservation.date_iso }}">
            <input type="hidden" name="slot" value="{{ reservation.slot }}">
            
            <!-- Personal Information -->
            <fieldset class="form-fieldset">
                <legend>Informa√ß√µes pessoais</legend>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="first_name" class="form-label">
                            Nome *
                        </label>
                        <input type="text" 
                               id="first_name" 
                               name="first_name" 
                               class="form-input"
                               required
                               autocomplete="given-name"
                               aria-describedby="first_name_error">
                        <div class="form-error" id="first_name_error" role="alert"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="last_name" class="form-label">
                            Sobrenome *
                        </label>
                        <input type="text" 
                               id="last_name" 
                               name="last_name" 
                               class="form-input"
                               required
                               autocomplete="family-name"
                               aria-describedby="last_name_error">
                        <div class="form-error" id="last_name_error" role="alert"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="email" class="form-label">
                        Email *
                    </label>
                    <input type="email" 
                           id="email" 
                           name="email" 
                           class="form-input"
                           required
                           autocomplete="email"
                           aria-describedby="email_help email_error">
                    <div class="form-help" id="email_help">
                        Voc√™ receber√° o c√≥digo de acesso neste email
                    </div>
                    <div class="form-error" id="email_error" role="alert"></div>
                </div>
            </fieldset>
            
            <!-- Terms and Conditions -->
            <fieldset class="form-fieldset">
                <legend>Termos e condi√ß√µes</legend>
                
                <div class="form-group checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" 
                               id="terms" 
                               name="terms" 
                               class="checkbox-input"
                               required
                               aria-describedby="terms_error">
                        <span class="checkbox-custom"></span>
                        <span class="checkbox-text">
                            Aceito os <a href="#" target="_blank">termos de uso</a> e 
                            <a href="#" target="_blank">pol√≠tica de privacidade</a> *
                        </span>
                    </label>
                    <div class="form-error" id="terms_error" role="alert"></div>
                </div>
                
                <div class="form-group checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" 
                               id="newsletter" 
                               name="newsletter" 
                               class="checkbox-input">
                        <span class="checkbox-custom"></span>
                        <span class="checkbox-text">
                            Quero receber novidades e promo√ß√µes por email
                        </span>
                    </label>
                </div>
            </fieldset>
            
            <!-- Form Actions -->
            <div class="form-actions">
                <button type="button" 
                        class="btn btn-secondary"
                        onclick="history.back()">
                    ‚Üê Voltar
                </button>
                
                <button type="submit" 
                        class="btn btn-primary"
                        id="submitBtn">
                    <span class="btn-text">Confirmar Reserva</span>
                    <span class="btn-loading" aria-hidden="true">
                        <span class="spinner-small"></span>
                        Processando...
                    </span>
                </button>
            </div>
        </form>
    </div>
    
    <!-- Sidebar with additional info -->
    <aside class="reservation-sidebar">
        <div class="sidebar-card">
            <h3>üí° Dicas importantes</h3>
            <ul class="tips-list">
                <li>Chegue pontualmente no hor√°rio reservado</li>
                <li>Guarde bem o c√≥digo de acesso</li>
                <li>A cabine ser√° liberada automaticamente</li>
                <li>Em caso de problemas, entre em contato</li>
            </ul>
        </div>
        
        <div class="sidebar-card">
            <h3>üìû Precisa de ajuda?</h3>
            <p>Entre em contato conosco:</p>
            <p><strong>Email:</strong> <a href="mailto:suporte@attenua.com">suporte@attenua.com</a></p>
            <p><strong>Telefone:</strong> (11) 9999-9999</p>
        </div>
    </aside>
</section>
{% endblock %}

{% block scripts %}
<script>
    // Configura√ß√£o para valida√ß√£o do formul√°rio
    window.RESERVATION_CONFIG = {
        cabin_id: {{ cabin.id }},
        date_iso: '{{ reservation.date_iso }}',
        slot: '{{ reservation.slot }}',
        validation_endpoint: '/api/validate'
    };
</script>
{% endblock %}

